<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>Docker - Volumes et Networks</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reset.css" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/solarized.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/base16/zenburn.css" />


  <script type="text/javascript">
      setTimeout(() => { 
        fetch("https://raw.githubusercontent.com/Alex-Octocorn/logo/main/style.js") 
          .then(script => script.text())
          .then((script) => {
            const head = document.querySelector("head");
            const customCss = document.createElement("script");
            customCss.type = "text/javascript";
            customCss.appendChild(document.createTextNode(script));
            head.appendChild(customCss);
          });
      });
    </script></head>
  <body>
    <div class="reveal">
      <div class="slides"><section ><section data-markdown><script type="text/template">

# Volumes

![Docker logo](assets/docker-logo.png) <!-- .element width="70%" align="left" -->
![HDD](assets/hdd.png) <!-- .element width="30%" align="right" -->
</script></section><section data-markdown><script type="text/template">
## Rappels

- Un conteneur est **éphémère**.
- Les données sont **perdues** à l'arrêt du conteneur.
- La couche de données est **en lecture seule**.

> Comment faire pour conserver des données ?

</script></section><section data-markdown><script type="text/template">
## Solution : les volumes

Les volumes permettent :
- La persistance des données
- Le partage des données
</script></section><section data-markdown><script type="text/template">
## Trois types de volumes

![Bind vs Volume](assets/bind-vs-volume.png) <!-- .element width="40%" -->

- **Bind mount** : Montage d'un dossier de l'hôte dans le conteneur
- **Volume** : Montage d'un dossier dans le conteneur
- **tmpfs** : Montage d'un dossier en mémoire (linux uniquement)
</script></section><section data-markdown><script type="text/template">
## Bind mount
### Définition 

![Docker Volumes](assets/docker-volumes.png) <!-- .element width="30%" -->

- Dossier partagé entre l'hôte et le conteneur
- Fonctionne un peu comme un dossier partagé sur le réseau
- Les données sont stockées sur le système hôte
</script></section><section data-markdown><script type="text/template">
## Bind mount
### Syntaxe

- Que ce soit dans un `Dockerfile`, dans un `docker run ...` ou un `docker-compose.yml`, la syntaxe ressemblera à :

```shell
<chemin_hote>:<chemin_absolu_conteneur>
```

Exemple :
> `docker run -v $(pwd):/app ...`
</script></section><section data-markdown><script type="text/template">
## Bind mount
### Précisions

- Le dossier de l'hôte doit exister
- Le dossier du conteneur sera créé s'il n'existe pas
- Le contenu du dossier du conteneur sera écrasé par celui du dossier de l'hôte
</script></section><section data-markdown><script type="text/template">
## Bind mount
### Précisions

- Historiquement, c'était le seul type existant
- Il manque de stabilité, et peut entrainer des problèmes de droits sur certains OS
- **L'usage des Bind mount est déconseillé en production**
- Avec la commande `docker run`, il est préférable d'utiliser des **volumes**
</script></section><section data-markdown><script type="text/template">
## Volume
### Définition

- Contrairement au bind mount, le volume n'est pas lié à un dossier de l'hôte
- Les données sont stockées dans le filesystem de Docker
- Elles sont accessibles depuis tous les conteneurs qui utilisent le volume
</script></section><section data-markdown><script type="text/template">
## Volume
### Syntaxe

- La syntaxe est très similaire à celle du bind mount
- La différence se situe au niveau du chemin du conteneur

```shell
<chemin_absolu_conteneur>
```
</script></section><section data-markdown><script type="text/template">
## Volume
### Exemple

- On veut créer un volume dans le dossier `/app` du conteneur

```shell
docker run -v /app --name ubuntu -it ubuntu
```

- On peut ensuite consulter les volumes disponibles avec la commande `docker volume ls`
- Le volume créé sera alors dit 'anonymous'
</script></section><section data-markdown><script type="text/template">
## Volume
### Naming

- Par défaut, Docker génère un nom de volume aléatoire
- On peut spécifier un nom de volume comme suit : `<nom_volume>:<path>`

```shell
docker run -v <nom_volume>:/app --name ubuntu -it ubuntu
```
</script></section><section data-markdown><script type="text/template">
## Volumes
### Autres commandes

- `docker volume ls` : Liste les volumes
- `docker volume inspect <nom_volume>` : Affiche les informations sur un volume
- `docker volume rm <nom_volume>` : Supprime un volume
- `docker volume prune` : Supprime tous les volumes inutilisés
- `docker volume create <nom_volume>` : Crée un volume
</script></section><section data-markdown><script type="text/template">
## Démonstration !

Persistence de données avec un volume
</script></section></section><section ><section data-markdown><script type="text/template">
## Networks

![Docker logo](assets/docker-logo.png) <!-- .element width="70%" align="left" -->

![Network](assets/network.png) <!-- .element width="30%" align="right" -->
</script></section><section data-markdown><script type="text/template">
## Réseau
### Définition

> Le terme 'réseau' désigne un ensemble, connecté par des liens physiques ou logiques

- Réseau LinkedIn
- Réseau de neurones
- Réseau autoroutier
- Réseau ferroviaire....
</script></section><section data-markdown><script type="text/template">
## Réseau
### Dans l'informatique

> "Ensemble d'ordinateurs ou de terminaux interconnectés par des télécommunications généralement permanentes." Larousse.fr

- Les équipements sont reliés par des câbles, des ondes radio, etc.
- Différents équipements, protocoles, services permettent la communication entre les équipements
</script></section><section data-markdown><script type="text/template">
## Réseau
### WAN

- Réseau dit 'publique'
- Désigne un réseau qui couvre une zone géographique étendue (internet)
- Chaque réseau est identifié par une adresse **IP publique**
</script></section><section data-markdown><script type="text/template">
## Réseau
### LAN

- Réseau dit 'local'
- Désigne un réseau qui couvre une zone géographique restreinte (entreprise, maison, etc.)
- Chaque réseau est identifié par une adresse **IP privée**
</script></section><section data-markdown><script type="text/template">
## Réseau
### Analogie

- J'habite dans un immeuble situé à Lille : j'ai une adresse postale (IP publique)
- Mon immeuble est constitué d'appartements ayant chacun un numéro de porte (IP privée)
</script></section><section data-markdown><script type="text/template">
## Réseau
### DNS

- Le DNS (Domain Name System) est un service permettant de faire le lien entre une adresse IP et un nom de domaine
- Il permet de simplifier l'accès aux ressources du réseau (sites internet par exemple)
</script></section><section data-markdown><script type="text/template">
## Réseau
### DNS : Analogie

- Si je vous donne rendez-vous à `50.6323862851061, 3.0533576082538403` (**IP**), vous aurez du mal à me retrouver
- Si je vous donne rendez-vous à `3 Rue des Primeurs, 59000 Lille` (**Nom de domaine**), vous pourrez me retrouver facilement
- Le DNS fait le lien entre les deux, et permet de retrouver l'adresse IP à partir du nom de domaine
</script></section><section data-markdown><script type="text/template">
## Réseau
### Routeur

- Le routeur est un équipement réseau permettant de faire communiquer deux réseaux entre eux
- Il permet (entre autres) de faire le lien entre le réseau local et le réseau publique
- Votre box internet est un routeur !
</script></section><section data-markdown><script type="text/template">
## Réseau
### Routeur : Analogie

- Je vous donne rendez-vous à mon adresse, mais ne précise pas mon numéro d'appartement
- Arrivé devant, vous allez vous adresser au concierge (routeur) pour savoir où je me trouve
- Le concierge vous indique mon numéro d'appartement (IP privée) et vous pouvez me contacter

> NB : Version très simplifiée, mais vous avez saisi l'idée ! 
</script></section><section data-markdown><script type="text/template">
## Networks Docker
### Types de réseaux

Dans Docker, on distingue plusieurs types de réseaux :
- **Bridge** 
- **None**
- **Host**
- **Overlay**
- **Macvlan**

> Dans ce cours, nous nous concentretons sur le **Bridge** et le **Host**
</script></section><section data-markdown><script type="text/template">
## Networks
### Bridge

![Bridge](assets/bridge.png) <!-- .element width="30%" -->

- Le réseau bridge est le réseau par défaut
- Il alloue une IP privée au conteneur (ex: 172.16.0.1)
</script></section><section data-markdown><script type="text/template">
## Networks
### Host

- Le conteneur utilise le réseau de l'hôte
- Il n'a pas d'IP privée : il utilise l'IP de l'hôte
- Du point de vue du routeur, le conteneur est l'hôte
- Pour accéder aux services, il faudra utiliser les ports de l'hôte
</script></section><section data-markdown><script type="text/template">
## Networks
### DNS

- Le DNS est géré par le routeur de Docker
- Les conteneurs peuvent se joindre entre eux par leur nom
</script></section><section data-markdown><script type="text/template">
## Networks
### Commandes

- `docker network ls` : Liste les réseaux
- `docker network inspect <nom_reseau>` : Affiche les informations sur un réseau
- `docker network rm <nom_reseau>` : Supprime un réseau
- `docker network prune` : Supprime tous les réseaux inutilisés

> Les usages réseau seront utilisés dans le chapitre des docker-compose !
</script></section><section data-markdown><script type="text/template">
# La suite !

- [Index](/index.html)</script></section></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        slideNumber: true,
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>

    <script src="./_assets/theme.js"></script>

    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
